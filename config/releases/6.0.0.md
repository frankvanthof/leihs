---
version_major: 6
version_minor: 0
version_patch: 0
version_pre: 'RC.1'
---

# Leihs 6.0.0-RC.1

TODO: write release notes (see [comments](https://github.com/leihs/leihs/pull/962))

## Changes from git log:

### admin

- suspensions edit: use DatePicker
- remove logging/spy
- dev: scripts (build UI if not cached)
- chore: cleanup scripts
- Extend available-fields of users resource
- shared-clj: check csrf token also for non-session requests
- database: users organization constraint
- delegation suspension own page
- DB: Rename leihs-local org to local
- Implement quick suspension reset
- Set account_enabled filter to yes per default for all */users/ resources
- Fix delegation endpoint, remove status from success message
- database: fix migration 591
- Improve some users/groups UI/UX aspects
- Fix data migration
- Add system_admin_protected and more
- db: all users group & respective triggers
- delegations suspensions
- Grant lending_managers access to entitlement_groups
- Batch of improvements 1000-1005
- Improvements 999-1005; modals for roles and suspensions
- edit user data inside a pool
- create user inside a pool
- Fix cache busting for some assets
- First batch of UI/UX improvements wrt GH 999 - 1005
- tidy up and annotate misc settings
- db: settings cleanup
- Switch frondend build to use shadow-cljs
- db: customer orders non blank purpose and title
- Manage settings
- namespace reload dev setup resurrected
- Add UI for audits and rework audits
- shared-clj: fix function docs
- DB: fixes and improvements for audit functions
- Set audited_requests/http_uid via reverse proxy http-uid
- Clean-up: disable some debug calls
- DB: change audited_requests and audited_responses
- Shared-clj: do not store data with audited_request/response
- DB: extend and rework audited_changes
- Delegations and permissions refactoring
- shared-clj: fix database helper
- database: silence restore feeds output
- leihs-ui: ModelFilterForm comp for mobile app
- fix: shared-clj: pool permissions query
- shared-clj: fix anti-csrf
- db: remaining stuff for seeds
- db: seeds
- chore: update shared-cljs, leihs-ui
- DB: remove leftover language_id references
- Rework CI and build scripts
- Reafcatoring languages table
- chore: update leihs-ui
- cider: dont crash on s3 upload
- Entitlement-groups: add links to title and link to lending
- Fix and spec "direct members" filter
- Remove link to same page; fix name inventory-pool name-component
- Remove user count on entitlement-group users page
- Fix users "Is Admin" and "Acount enabled" filters
- Remove hyphen in membership filters
- chore: update leihs-ui
- ci: build script debugging
- Entitlements and delegations via groups, UI improvement roles
- trigger ci
- leihs-ui: csrf constants
- shared-clj: csrf constants
- update leihs-ui

### borrow

- chore: update legacy-api
- chore: update leihs-ui
- chore: update legacy-api
- shared-clj: check csrf token also for non-session requests
- database: users organization constraint
- chore: update legacy-api
- DB: Rename leihs-local org to local
- shared-clj: add :route to routing state
- database: fix migration 591
- DB: fix keep delegations on pools
- Fix data migration
- chore: update legacy-api
- DB changes: system_admin, organization, protected, etc
- db: all users group instead of automatic access
- Update shared-clj: improve select-component
- update legacy-api
- chore: update legacy-api
- clj-shared extensions for admin
- update legacy-api
- db: settings cleanup
- Update shared-clj, prepare for deps.edn and shadow-cljs
- update legacy-api
- db: customer orders non blank purpose and title
- Split settings table
- update legacy-api
- navigate to orders show after submit order
- update legacy-api
- DB: change audited_requests and audited_responses; Update shared-clj: audits
- deal with drafts in refresh timeout
- shared-clj: fix function docs
- DB: fixes and improvements for audit functions
- Set audited_requests/http_uid via reverse proxy http-uid
- DB: change audited_requests and audited_responses
- Shared-clj: do not store data with audited_request/response
- DB: extend and rework audited_changes
- Delegations and permissions refactoring
- contracts & pickups & returns
- shared-clj: fix database helper
- database: silence restore feeds output
- ModelFilterForm comp for mobile app
- fix categories and breadcrumbs
- categories breadcrumbs
- fix: errors on some show pages
- fix: include inactive pools in customer order sub-orders
- fix: shared-clj: pool permissions query
- fix: missing quantity in models query
- update legacy-api
- shared-clj: fix anti-csrf
- models search result caching
- search panel local state
- update legacy-api
- update legacy-api
- db: remaining stuff for seeds
- db: seeds
- chore: update shared-cljs, leihs-ui
- DB: remove leftover language_id references
- Rework CI and build scripts
- update legacy-api
- Refactoring languages
- resurrect: abort running queries on change view
- resource url for all show pages
- ui: improve app layout, use more shared ui
- ci: remove duplicate job
- cider: dont crash on s3 upload
- abort running queries on change view
- update legacy-api
- update legacy-api
- chore: update leihs-ui
- Entitlements and delegations via groups
- fix has reservable items perf
- enable and fix anti-csrf
- calendar fixes & improvements

### database

- users organization constraint
- Rename leihs-local org to local
- fix migration 591
- Fix: keep delegations on pools
- Fix data migration
- Add migration system_admin_protected_etc
- all users group & respective triggers
- remove unused settings
- customer orders non blank purpose and title
- Split settings table
- Some changes for audited_requests and audited_responses
- Fixes and improvements for audit functions
- Change audited_requests and audited_responses
- Extend and rework audited_changes
- Add protected fields; prevent delegation auto add, remove system_admin_groups
- Be quiet!
- adjust user password reset factory
- remaining stuff for seeds
- seeds
- Fix: remove leftover language_id references
- Refactoring languages table
- Entitlements and delegations via groups

### deploy

- dev: split up release notes
- Add explicit db migration; postpone settings
- Split settings table
- Redirect `/admin/top` to `/admin/`
- Reverse-proxy: set http-uid heander and log value via mod_unique_id
- Fix startup admin service
- Reroute `/admin/statistics` from legacy to admin service
- fix: set base_url in db settings
- fix: enforce PostgreSQL version 10
- fix: setup DB before restoring
- fix: dont use templated variables in condition
- fix: cleanup ansible remote tmp dir
- fix: local_tar_cmd role dependencies
- remove public schema workaround
- apache: update SSL/TLS config
- fix: workaround for restore-dump
- Fix restore-dump
- create db and seed it if not exists
- Fix ansible pipe in vim role
- Clean up S3 references
- Rework CI and build scripts
- Support Ubuntu 20.04; upgrade Ansible and use python 3.8

### integration-tests

- Adjust factories wrt system_admin changes
- Adjust specs
- configure wait until -> fix step
- Workaround for failing test
- customer orders non blank purpose and title
- Manage settings in new admin and split settings table
- borrow: redirect after confirm order
- Redirect /admin/top to /admin/; adjust integration tests
- Reverse-proxy: set http-uid heander and log value via mod_unique_id
- Delegations and permissions refactoring
- fix: config for installing `ffi` gem on macOS
- db: seeds
- FIXUP lang locale 2 #psh
- Refactoring languages
- Adjust specs for "entitlements and delegations via groups"
- extend global session feature with app borrow

### legacy

- improve display of version and release notes
- remove serialize extended_info
- database: users organization constraint
- disable user edit
- DB: Rename leihs-local org to local
- database: fix migration 591
- DB: fix keep delegations on pools
- Fix data migration
- more "new admin" text adjustments
- manage: enhance links to new admin for users and delegations
- ci: debug assets check
- DB changes: system_admin, organization, protected, etc
- db: all users group instead of automatic access
- db: all users group instead of automatic access
- remove automatic access
- db: all users group instead of automatic access
- create user moved to admin
- manage: link to new admin for users and delegations
- replace default_email with default_from_address
- db: settings cleanup
- fix restore prod dump script
- db: customer orders non blank purpose and title
- Split settings table, change some smtp related fields
- ci: increase timeouts
- audits middleware
- DB: change audited_requests and audited_responses
- DB: fixes and improvements for audit functions
- DB: change audited_requests and audited_responses
- DB: extend and rework audited_changes
- DB: add protected fields; prevent delegation auto add, remove system_admin_groups
- Add bin/db-copy(create|restore)
- Sparse prod-restore
- database: silence restore feeds output
- fix: translation in booking calendar
- db: adjust user reset password factory
- fix: config for installing `ffi` gem on macOS
- fix meta checks
- db: remaining stuff for seeds
- db: seeds
- DB: remove leftover language_id references
- fix: new timeline and entitlement scope
- Refactoring languages table
- fix: consider entitlements only in the same pool
- fix: ancestors for borrowable categories
- Entitlements and delegations via groups

### mail

- shared-clj: check csrf token also for non-session requests
- database: users organization constraint
- DB: Rename leihs-local org to local
- shared-clj: add :route to routing state
- database: fix migration 591
- DB: fix keep delegations on pools
- Fix data migration
- Update shared-clj: adjustments for system-admin migration
- Update DB: add migration system_admin_protected_etc
- db: all users group & respective triggers
- Update shared-clj: improve select-component
- clj-shared extensions for admin
- db: settings cleanup
- Update shared-clj, prepare for deps.edn and shadow-cljs
- dont send emails if smtp disabled
- db: customer orders non blank purpose and title
- Use exclusivly smtp_settings table
- Split settings table
- Update shared-clj: audits
- DB: change audited_requests and audited_responses
- shared-clj: fix function docs
- DB: fixes and improvements for audit functions
- Set audited_requests/http_uid via reverse proxy http-uid
- DB: change audited_requests and audited_responses
- Shared-clj: do not store data with audited_request/response
- DB: extend and rework audited_changes
- Delegations and permissions refactoring
- shared-clj: fix database helper
- database: silence restore feeds output
- fix: shared-clj: pool permissions query
- shared-clj: fix anti-csrf
- db: remaining stuff for seeds
- db: seeds
- chore: update shared-cljs
- DB: remove leftover language_id references
- Rework CI and build scripts
- refactor settings handling and logging
- Refactoring languages
- cider: dont crash on s3 upload
- Entitlements and delegations via groups
- shared-clj: csrf constants

### my

- chore: update leihs-ui
- shared-clj: check csrf token also for non-session requests
- database: users organization constraint
- DB: Rename leihs-local org to local
- shared-clj: add :route to routing state
- database: fix migration 591
- DB: fix keep delegations on pools
- Fix data migration
- Adjustements for migration system_admin_users -> users.is_system_admin
- db: all users group & respective triggers
- Update shared-clj: improve select-component
- Fix frontent require problem
- clj-shared extensions for admin
- db: settings cleanup
- Update shared-clj, prepare for deps.edn and shadow-cljs
- db: customer orders non blank purpose and title
- Split settings table
- Update shared-clj: audits
- DB: change audited_requests and audited_responses
- shared-clj: fix function docs
- DB: fixes and improvements for audit functions
- Set audited_requests/http_uid via reverse proxy http-uid
- DB: change audited_requests and audited_responses
- Shared-clj: do not store data with audited_request/response
- DB: extend and rework audited_changes
- shared-clj: permission refactoring, some extension, clean-up
- shared-clj: fix database helper
- database: silence restore feeds output
- leihs-ui: ModelFilterForm comp for mobile app
- fix: shared-clj: pool permissions query
- shared-clj: fix anti-csrf
- fix: config for installing `ffi` gem on macOS
- db: remaining stuff for seeds
- db: seeds
- fix: language/locale handling changes
- DB: remove leftover language_id references
- Rework CI and build scripts
- Refactoring languages
- chore: update leihs-ui
- cider: dont crash on s3 upload
- chore: update leihs-ui
- Entitlements and delegations via groups
- leihs-ui: csrf constants
- shared-clj: csrf constants
- update leihs-ui

### procure

- chore: update leihs-ui
- shared-clj: check csrf token also for non-session requests
- database: users organization constraint
- DB: Rename leihs-local org to local
- shared-clj: add :route to routing state
- database: fix migration 591
- DB: fix keep delegations on pools
- Fix data migration
- DB changes: system_admin, organization, protected, etc
- db: all users group instead of automatic access
- Update shared-clj: improve select-component
- clj-shared extensions for admin
- db: settings cleanup
- Update shared-clj, prepare for deps.edn and shadow-cljs
- db: customer orders non blank purpose and title
- Split settings table
- ci: fix build script dependencies
- Update shared-clj: audits
- DB: change audited_requests and audited_responses
- shared-clj: fix function docs
- DB: fixes and improvements for audit functions
- Set audited_requests/http_uid via reverse proxy http-uid
- DB: change audited_requests and audited_responses
- Shared-clj: do not store data with audited_request/response
- DB: extend and rework audited_changes
- Delegations and permissions refactoring
- shared-clj: fix database helper
- database: silence restore feeds output
- build(deps): bump ini from 1.3.5 to 1.3.7 in /client (#70)
- leihs-ui: ModelFilterForm comp for mobile app
- fix: shared-clj: pool permissions query
- shared-clj: fix anti-csrf
- fix: config for installing `ffi` gem on macOS
- db: remaining stuff for seeds
- db: seeds
- Fix server specs: dedicated bundle
- chore: update shared-cljs, leihs-ui
- DB: remove leftover language_id references
- Rework CI and build scripts
- Refactoring languages
- chore: update leihs-ui
- cider: dont crash on s3 upload
- chore: update leihs-ui
- Entitlements and delegations via groups
- remove unused constants
- leihs-ui: csrf constants
- shared-clj: csrf constants
- update leihs-ui

### zhdk-inventory

- script for #1043
- dont send mails for ffzh staging
- move settings to variables
- cleanup obsolete hosts
- enable new borrow app on staging
- Set external_base_url for tom to tom.leihs.zhdk.ch

